# Only test building images
name: PullRequest-cc-analysis
on:
  pull_request:
    paths:
      - 'docker/prepare-env/prepare-env-cc-analysis.sh'
      - 'docker/jupyterhub/**'
      - 'docker/dask/**'
      - 'docker/uproot/**'
      - 'docker/k8s-worker/**'
      - 'docker/Dockerfile.cc-analysis-centos7'
      - 'docker/Dockerfile.cc-analysis-ubuntu'
    branches:
      - master
      - develop
env:
  DOCKER_ORG: coffeateam
  GITHUB_SHA: ${{ github.sha }}
  GITHUB_REF: ${{ github.ref }}
jobs:
  matrix-build:
    strategy:
      fail-fast: false
      matrix:
        IMAGE: [cc-analysis-centos7,
                cc-analysis-ubuntu]
    name: ${{ matrix.IMAGE }}
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1
    - name: Build and push
      uses: docker/build-push-action@v2
      with:
        context: .
        file: Dockerfile.${{ matrix.IMAGE }}
        tags: ${{ matrix.IMAGE }}:PR
        platforms: linux/amd64